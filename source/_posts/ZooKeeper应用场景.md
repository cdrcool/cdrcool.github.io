---
title: ZooKeeper 应用场景
date: 2020-01-31 10:52:00
categories: ZooKeeper
---
ZooKeeper 是一个开源的分布式协同服务系统。ZooKeeper 的设计目标是将那些复杂且容易出错的分布式协同服务封装起来，抽象出一个高效可靠的原语集，并以一系列简单的接口提供给用户使用。
利用 ZooKeeper 可以非常方便构建一系列分布式应用中都会涉及到的核心功能。

### 数据发布/订阅
数据发布/订阅的一个常见的场景是配置中心：发布者把数据发布到 ZooKeeper 的一个或一系列的节点上，供订阅者进行数据订阅，达到动态获取数据的目的。

配置信息一般有几个特点:
* 数据量小的KV
* 数据内容在运行时会发生动态变化
* 集群机器共享，配置一致

ZooKeeper 采用的是推拉结合的方式：
* 推: 服务端会推给注册了监控节点的客户端 Watcher 事件通知
* 拉: 客户端获得通知后，然后主动到服务端拉取最新的数据

数据发布/订阅的另一个常见的场景是服务注册中心，不过由于 ZooKeeper 是基于 CP 原则构建的，因此不适合做服务注册与发现。

### 负载均衡
负载均衡是一种手段，用来把对某种资源的访问分摊给不同的设备，从而减轻单点的压力。
我们可以自定义一个负载均衡算法，在每个请求过来时从 ZooKeeper 服务器中获取当前集群服务器列表，根据算法选出其中一个服务器来处理请求。

### 命名服务
命名服务就是提供名称的服务。
ZooKeeper 的命名服务有以下两个应用方面：
* 提供类 JNDI 功能，可以把系统中各种服务的名称、地址以及目录信息存放在 ZooKeeper，需要的时候去 ZooKeeper 中读取。
* 制作分布式的序列号生成器。

### 分布式协调/通知
分布式协调/通知是将不同的分布式组件有机结合起来的关键所在。对于一个在多台机器上部署运行的应用而言，通常需要一个协调者(Coordinator)来控制整个系统的运行流程，例如分布式事务的处理、机器间的相互协调等。同时，引入这样一个协调者，便于将分布式协调的职责从应用中分离出来，从而大大减少系统之间的耦合性，而且能够显著提高系统的可扩展性。

### 集群管理
所谓集群管理，包括集群监控与集群控制两大块，前者侧重对集群运行时状态的收集，后者则是对集群进行操作与控制。在日常开发和运维过程中，我们经常会有类似于如下的需求：
* 希望知道当前集群中究竟有多少机器在工作
* 对集群中每台机器的运行时状态进行数据收集
* 对集群中机器进行上下线操作

ZooKeeper 具有以下两大特性：
* 客户端如果对 ZooKeeper 的一个数据节点注册 Watcher 监听，那么当该数据节点的内容或是其子节点列表发生变更时，ZooKeeper 服务器就会向订阅的客户端发送变更通知。
* 对在 ZooKeeper 上创建的临时节点，一旦客户端与服务器之间的会话失效，那么该临时节点也就被自动清除。
利用 ZooKeeper 的这两大特性，我们可以很方便地实现集群机器存活性监控的系统。

### 分布式队列
ZooKeeper 可以处理两种类型的队列：
    + 当一个队列的成员都聚齐时，这个队列才可用，否则一直等待所有成员到达，这种是同步队列。
    + 队列按照 FIFO 方式进行入队和出队操作，例如实现生产者和消费者模型。

### 分布式锁
单机程序的各个进程需要对互斥资源进行访问时需要加锁，那分布式程序分布在各个主机上的进程对互斥资源进行访问时也需要加锁。很多分布式系统有多个可服务的窗口，但是在某个时刻只让一个服务去干活，当这台服务出问题的时候锁释放，立即 fail over 到另外的服务。

参考资料：
[ZooKeeper 的应用场景](https://zhuanlan.zhihu.com/p/59669985)